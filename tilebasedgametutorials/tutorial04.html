<!DOCTYPE HTML>
<!---------------------------------------------->
<!-- tutorial04.html. Frank Poth. 04/23/2015. -->
<!---------------------------------------------->

<!-- Square Collision. -->

<!-- HTML. -->
<html>
	<!-- Head. -->
	<head>
		<!-- Link. -->
		<link href="tilebasedgametutorials.css" rel="stylesheet" type="text/css">
		<!-- Meta. -->
		<meta content="width=device-width" name="viewport">
		<!-- Title. -->
		<title>Tile Based Game Tutorials | Tutorial04</title>
	</head>

	<!-- Body. -->
	<body>
		<!-- Header. -->
		<div id="header">
			<h2>Tile Based Game Tutorials</h2>
		</div>
		<!-- Content. -->
		<div id="content">
			<h2> Square Collision </h2>
			<p>
				Here it is, the basics of tile based collision detection. The ultimate platforming game collision detection technique. If you gamed as a child, you probably spent hours upon hours staring deep into the screen on your Gameboy Color wondering how they made the magic of collision so smooth and appealing. Or maybe you just played the games. Either way, collision was still happening right before your eyes. Beautiful, beautiful square collision.
			</p>
			<canvas class="Canvas" id="display">
				canvas
			</canvas>
			<p>
				Magical, isn't it? Well, not really. It's just simple math. In fact, it's based on the same simple math used to calculate row and column values in the first two tutorials coupled with some actual collision code. Here's how it works:
			</p>
			<p>
				Say your red square is falling down. His y velocity is greater than 0, so you know he's moving downwards. What happens when your game objects move? Collisions happen, of course! So you'll want to check to see if the red square is colliding with a tile on his bottom side. But how do we do that? That's the tricky part. First take a look at the collision code:
			</p>
			<pre class="Math">var bottom = Math.floor(object_.getMaximumY() / tile_sheet.tile_height);
var left = Math.floor((object_.position.x - object_.velocity.x + 1) / tile_sheet.tile_width);
var right = Math.floor((object_.getMaximumX() - object_.velocity.x - 1) / tile_sheet.tile_width);
var top = Math.floor(object_.position.y / tile_sheet.tile_height);

if (object_.velocity.y > 0 && (this.values[bottom * this.columns + left] == 0 || this.values[bottom * this.columns + right] == 0)) {
	object_.airborne = false;
	object_.velocity.y = 0;
	object_.last_position.y = object_.position.y = bottom * tile_sheet.tile_height - object_.height;
}</pre>
			<p>
				Bottom, left, right, and top are the row and column positions of the corners of the object. Left and right are altered because we are doing collision on the y axis in this chunk of code. By subtracting velocity and offsetting by 1 pixel, you ensure that the object won't get caught on the wrong side of a tile. We want collision with the top of a tile in this case, not the left or right side (it makes more sense in context so look at the source).
			</p>
			<p>
				After determining the row and column positions that the object occupies, you have to check the tile values at those rows and columns in the map. For a downward moving object, you want to check the tiles under its bottom left and bottom right corners. So you convert your row and column values into a one dimensional index and use it to get the value of the tile under each corner of the object. If that value is equal to 0, you know you have a collision!
			</p>
			<p>
				After the collision is detected, you know that since the object is moving down, you must push him back up to resolve the collision. This is easy because you already know the row value of the tile you are colliding with. Getting the position where your object should be is as simple as multiplying that row by the tile height and then subtracting the object's height.
			</p>
			<br>
			<a id="left_link" href="tutorial03.html">Tutorial03</a>
			<a id="center_link" href="index.html">Index</a>
			<a id="right_link" href="tutorial05.html">Tutorial05</a>
		</div>
		<!-- Footer. -->
		<div id="footer">
			<a href="https://github.com/userpoth/tilebasedgametutorials">GitHub Repository</a>
		</div>
		<!-- Script. -->
		<script src="tutorial04.js" type="text/javascript"></script>
	</body>
</html>